<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <meta name="color-scheme" content="dark" />
  <title>TWIN KART DS — Gift One-Sider</title>

  <style>
    /* ============================================================
      TWIN KART DS — FINAL Single-HTML
      Uses repo files (same folder):
        - rainbowRoad.mp3
        - nonchalant.jpg
        - sideeye.jpg
        - twins.jpg
        - twin.png
        - toadyoshi.png
        - 67.jpg
        - süslimüsli.jpg
        - ss.jpg
        - tischtennis.jpg
        - tortuga.jpg
      Optional:
        - Mario Kart DS - Rainbow Road.mp4
      Controls:
        - START / Enter -> begin, cups appear, music starts
        - M -> toggle music
        - R -> reset progress
        - 1..9 -> open cups quickly (hub)
        - Popup: click/Enter while typing -> instant reveal
        - WEITER shows next sentence
        - BEENDEN/Esc closes
        - Tortuga game: Space/↑/Click = jump, restart after crash
    ============================================================ */

    :root{
      --bg0:#050712; --bg1:#070b1a; --bg2:#0b1030; --bg3:#0d1538;
      --glass: rgba(255,255,255,.07);
      --glass2: rgba(255,255,255,.10);
      --line: rgba(255,255,255,.14);

      --paper: rgba(255,255,255,.94);
      --ink: rgba(0,0,0,.90);

      --c:#3df3ff;  --g:#7dff6a; --y:#ffd25a; --p:#ff4fa5; --v:#8e6cff;

      --shadow: rgba(0,0,0,.58);
      --shadow2: rgba(0,0,0,.42);

      --r1: 16px; --r2: 22px; --r3: 30px;

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;

      --scan: .14;
      --grain: .10;

      --easeOut: cubic-bezier(.18,.88,.22,1);
      --easeIn: cubic-bezier(.42,0,.58,1);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      overflow:hidden;
      font-family: var(--mono);
      background:
        radial-gradient(1400px 900px at 12% 14%, rgba(61,243,255,.09), transparent 62%),
        radial-gradient(1200px 900px at 82% 32%, rgba(255,79,165,.08), transparent 60%),
        radial-gradient(1200px 900px at 48% 92%, rgba(125,255,106,.08), transparent 62%),
        linear-gradient(180deg, var(--bg0), var(--bg2));
      color: rgba(255,255,255,.92);
      -webkit-tap-highlight-color: transparent;
    }

    button{ font-family: var(--mono); }
    img{ display:block; max-width:100%; }
    ::selection{ background: rgba(61,243,255,.22); }

    .px{
      text-rendering: geometricPrecision;
      letter-spacing: .45px;
      text-shadow:
        1px 0 0 rgba(255,255,255,.06),
        -1px 0 0 rgba(0,0,0,.12),
        0 1px 0 rgba(255,255,255,.05),
        0 -1px 0 rgba(0,0,0,.10);
    }

    /* ===================== Background FX ===================== */
    .bgFX{ position:fixed; inset:0; pointer-events:none; overflow:hidden; z-index:0; }
    .bgFX .grid{
      position:absolute; inset:-35%;
      background:
        linear-gradient(90deg, rgba(255,255,255,.06) 1px, transparent 1px) 0 0 / 18px 18px,
        linear-gradient(0deg, rgba(255,255,255,.05) 1px, transparent 1px) 0 0 / 18px 18px;
      transform: rotate(11deg);
      opacity:.16;
      animation: gridDrift 22s linear infinite;
      mix-blend-mode: screen;
      filter: blur(.2px);
    }
    @keyframes gridDrift{
      0%{ transform: translate3d(-4%, -2%, 0) rotate(11deg); }
      100%{ transform: translate3d(4%, 3%, 0) rotate(11deg); }
    }

    .bgFX .blob{
      position:absolute;
      width: 520px; height: 520px;
      border-radius: 999px;
      filter: blur(40px);
      opacity:.18;
      animation: blob 10s ease-in-out infinite alternate;
    }
    .bgFX .b1{ left:-170px; top:-190px; background: var(--c); animation-duration: 10.2s; }
    .bgFX .b2{ right:-220px; top: 70px; background: var(--p); animation-duration: 12.6s; }
    .bgFX .b3{ left: 22%; bottom:-260px; background: var(--g); animation-duration: 11.4s; }
    @keyframes blob{
      0%{ transform: translate3d(0,0,0) scale(1); }
      100%{ transform: translate3d(52px, 38px, 0) scale(1.16); }
    }

    .bgFX .stars{ position:absolute; inset:0; mix-blend-mode: screen; opacity:.60; }
    .bgFX .star{
      position:absolute;
      width:3px; height:3px;
      border-radius: 1px;
      background: rgba(255,255,255,.92);
      box-shadow: 0 0 14px rgba(61,243,255,.25);
      animation: tw 2.8s ease-in-out infinite;
    }
    @keyframes tw{
      0%,100%{ transform: scale(1); opacity:.55; }
      50%{ transform: scale(1.9); opacity:1; }
    }

    .bgFX .scan{
      position:absolute; inset:0;
      background: repeating-linear-gradient(
        to bottom,
        rgba(0,0,0,.12) 0px,
        rgba(0,0,0,.12) 1px,
        rgba(255,255,255,0) 3px,
        rgba(255,255,255,0) 6px
      );
      opacity: var(--scan);
      mix-blend-mode: multiply;
    }

    .bgFX .grain{
      position:absolute; inset:0;
      background-image:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='220' height='220' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
      opacity: var(--grain);
      mix-blend-mode: overlay;
      filter: contrast(140%) brightness(110%);
      animation: grainMove 10s steps(2,end) infinite;
    }
    @keyframes grainMove{
      0%{ transform: translate3d(0,0,0); }
      10%{ transform: translate3d(-2%, -1%, 0); }
      20%{ transform: translate3d(-4%, 1%, 0); }
      30%{ transform: translate3d(2%, -2%, 0); }
      40%{ transform: translate3d(4%, 1%, 0); }
      50%{ transform: translate3d(-2%, 2%, 0); }
      60%{ transform: translate3d(-3%, -1%, 0); }
      70%{ transform: translate3d(3%, -2%, 0); }
      80%{ transform: translate3d(2%, 2%, 0); }
      90%{ transform: translate3d(-1%, 1%, 0); }
      100%{ transform: translate3d(0,0,0); }
    }

    /* ===================== App Shell ===================== */
    .app{
      position:relative;
      z-index:1;
      height:100%;
      display:grid;
      place-items:center;
      padding: 18px;
    }

    .stage{
      width: min(1120px, 100%);
      height: min(780px, 92vh);
      border-radius: var(--r3);
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      backdrop-filter: blur(12px);
      box-shadow: 0 48px 140px rgba(0,0,0,.60);
      overflow:hidden;
      position:relative;
    }
    .stage::before{
      content:"";
      position:absolute; inset:-30%;
      background:
        radial-gradient(620px 480px at 25% 25%, rgba(61,243,255,.20), transparent 62%),
        radial-gradient(620px 480px at 78% 68%, rgba(255,210,90,.11), transparent 62%),
        radial-gradient(620px 480px at 70% 26%, rgba(255,79,165,.14), transparent 62%),
        radial-gradient(620px 480px at 48% 88%, rgba(125,255,106,.12), transparent 62%);
      filter: blur(28px);
      opacity:.92;
      animation: breathe 6.2s ease-in-out infinite alternate;
      pointer-events:none;
    }
    @keyframes breathe{
      0%{ transform: scale(1) translateY(0); }
      100%{ transform: scale(1.05) translateY(-7px); }
    }

    .screen{ position:relative; z-index:1; height:100%; padding: 18px; display:none; }
    .screen.show{ display:block; }

    /* ===================== Start Screen ===================== */
    .start{
      height:100%;
      border-radius: var(--r3);
      position:relative;
      overflow:hidden;
      display:grid;
      place-items:center;
    }
    .startVideo{
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit:cover;
      filter: saturate(120%) contrast(108%) brightness(88%);
      opacity:.55;
      transform: scale(1.06);
      animation: startVideoFloat 8s ease-in-out infinite alternate;
      display:none;
    }
    .startVideo.show{ display:block; }
    @keyframes startVideoFloat{
      0%{ transform: scale(1.06) translateY(0); }
      100%{ transform: scale(1.10) translateY(-10px); }
    }
    .startOverlay{
      position:absolute; inset:0;
      background:
        radial-gradient(800px 600px at 18% 20%, rgba(61,243,255,.22), transparent 62%),
        radial-gradient(800px 600px at 85% 35%, rgba(255,79,165,.18), transparent 62%),
        radial-gradient(900px 700px at 55% 92%, rgba(125,255,106,.14), transparent 64%),
        linear-gradient(180deg, rgba(0,0,0,.54), rgba(0,0,0,.28));
    }

    .startCard{
      width: min(860px, 94%);
      border-radius: var(--r3);
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.07);
      box-shadow: 0 48px 160px rgba(0,0,0,.62);
      backdrop-filter: blur(12px);
      padding: 22px 18px;
      text-align:center;
      position:relative;
      overflow:hidden;
      animation: popIn 520ms var(--easeOut) both;
    }
    @keyframes popIn{
      from{ transform: translateY(14px) scale(.985); opacity:0; }
      to{ transform: translateY(0) scale(1); opacity:1; }
    }
    .startCard::before{
      content:"";
      position:absolute; inset:-45%;
      background: repeating-linear-gradient(
        90deg,
        rgba(255,255,255,0) 0 18px,
        rgba(255,255,255,.22) 18px 20px,
        rgba(255,255,255,0) 20px 44px
      );
      transform: rotate(-16deg) translateX(-60%);
      opacity:.30;
      animation: shine 2.8s linear infinite;
      pointer-events:none;
    }
    @keyframes shine{
      0%{ transform: rotate(-16deg) translateX(-60%); }
      100%{ transform: rotate(-16deg) translateX(60%); }
    }

    .logo{ display:flex; flex-direction:column; gap: 12px; align-items:center; justify-content:center; }
    .logo h1{
      margin:0;
      font-size: clamp(30px, 4.6vw, 54px);
      letter-spacing: 2px;
      color: rgba(255,255,255,.96);
      text-shadow: 0 18px 70px rgba(0,0,0,.62), 0 0 42px rgba(61,243,255,.18);
    }
    .logo h1 .accent{
      color: var(--y);
      text-shadow: 0 18px 70px rgba(0,0,0,.62), 0 0 46px rgba(255,210,90,.18);
    }

    .subPills{ display:flex; flex-wrap:wrap; justify-content:center; gap: 10px; margin-top: 2px; }
    .pill{
      display:inline-flex; gap: 8px; align-items:center;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 24px 70px rgba(0,0,0,.36);
      user-select:none;
      white-space:nowrap;
      font-size: 12px;
      opacity:.95;
    }
    .dot{
      width: 10px; height: 10px;
      border-radius: 3px;
      background: rgba(255,255,255,.70);
      border: 1px solid rgba(255,255,255,.22);
      box-shadow: 0 0 18px rgba(61,243,255,.22);
    }

    .startBtn{
      margin-top: 14px;
      font-weight: 900;
      letter-spacing: 1px;
      font-size: 14px;
      color: rgba(0,0,0,.92);
      background:
        linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.80)),
        linear-gradient(180deg, rgba(61,243,255,.28), rgba(61,243,255,.10));
      border: 1px solid rgba(0,0,0,.18);
      border-bottom-width: 2px;
      border-radius: 18px;
      padding: 14px 22px;
      cursor:pointer;
      user-select:none;
      box-shadow: 0 26px 70px rgba(0,0,0,.52), 0 0 0 3px rgba(61,243,255,.12);
      transition: transform 140ms ease, filter 140ms ease;
      min-width: 240px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap: 12px;
      position:relative;
      overflow:hidden;
    }
    .startBtn:active{ transform: translateY(1px); filter: brightness(.99); }

    .kbd{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 2px 8px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.92);
      font-size: 12px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.10);
    }
    .hint{ margin: 12px 0 0 0; font-size: 12px; opacity:.88; color: rgba(255,255,255,.90); }

    /* ===================== Hub ===================== */
    .hubTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 14px;
      margin-bottom: 14px;
    }
    .hudLeft{ display:flex; flex-direction:column; gap: 10px; min-width: 280px; }
    .hudTitle{ font-size: 12px; display:flex; gap: 10px; align-items:center; flex-wrap:wrap; opacity:.95; }

    .bar{
      width: min(520px, 62vw);
      height: 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.25);
      overflow:hidden;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.10);
    }
    .fill{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, var(--c), var(--g));
      box-shadow: 0 0 18px rgba(61,243,255,.30);
      transition: width 520ms var(--easeOut);
    }

    .hudRight{ display:flex; flex-direction:column; align-items:flex-end; gap: 10px; }

    .btnSmall{
      font-weight: 900;
      letter-spacing:.7px;
      font-size: 12px;
      color: rgba(255,255,255,.92);
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      border-bottom-width: 2px;
      border-radius: 16px;
      padding: 10px 12px;
      cursor:pointer;
      user-select:none;
      backdrop-filter: blur(10px);
      box-shadow: 0 22px 50px rgba(0,0,0,.28);
      transition: transform 120ms ease, filter 120ms ease;
      min-width: 170px;
      text-align:center;
    }
    .btnSmall:active{ transform: translateY(1px); filter: brightness(.99); }

    .gridWrap{
      height: calc(100% - 86px);
      border-radius: var(--r3);
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      box-shadow: 0 34px 110px rgba(0,0,0,.42);
      backdrop-filter: blur(12px);
      position:relative;
      overflow:hidden;
      padding: 18px;
    }
    .gridWrap::before{
      content:"";
      position:absolute; inset:-25%;
      background:
        radial-gradient(520px 420px at 25% 25%, rgba(61,243,255,.18), transparent 62%),
        radial-gradient(520px 420px at 78% 70%, rgba(255,79,165,.14), transparent 62%),
        radial-gradient(520px 420px at 55% 20%, rgba(255,210,90,.12), transparent 62%);
      filter: blur(24px);
      opacity:.92;
      pointer-events:none;
    }

    .cups{
      position:relative;
      z-index:1;
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 16px;
      height:100%;
      align-content:start;
    }
    @media (max-width: 900px){ .cups{ grid-template-columns: repeat(2, minmax(0,1fr)); } .bar{ width: 70vw; } }
    @media (max-width: 540px){
      .cups{ grid-template-columns: 1fr; }
      .hubTop{ flex-direction:column; align-items:stretch; }
      .hudRight{ align-items:flex-start; }
      .btnSmall{ width:100%; }
      .bar{ width:100%; }
    }

    .cupBtn{
      position:relative;
      border-radius: var(--r2);
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.07);
      box-shadow: 0 28px 80px rgba(0,0,0,.34), inset 0 1px 0 rgba(255,255,255,.10);
      cursor:pointer;
      user-select:none;
      overflow:hidden;
      padding: 14px;
      display:grid;
      grid-template-rows:auto auto auto;
      gap: 12px;

      transform: translateY(18px) scale(.985);
      opacity:0;
      animation: cupIn 640ms var(--easeOut) forwards;
      transition: transform 170ms ease, box-shadow 170ms ease, border-color 170ms ease;
    }
    @keyframes cupIn{ to{ transform: translateY(0) scale(1); opacity:1; } }

    .cupBtn:hover{
      transform: translateY(-3px);
      border-color: rgba(61,243,255,.34);
      box-shadow: 0 36px 100px rgba(0,0,0,.40), 0 0 0 3px rgba(61,243,255,.12), inset 0 1px 0 rgba(255,255,255,.12);
    }
    .cupBtn:active{ transform: translateY(-1px) scale(.995); }
    .cupBtn::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(220px 160px at 20% 20%, rgba(61,243,255,.20), transparent 62%),
        radial-gradient(220px 160px at 85% 85%, rgba(255,210,90,.12), transparent 62%);
      opacity:.60;
      filter: blur(12px);
      pointer-events:none;
      transition: opacity 170ms ease;
    }
    .cupBtn:hover::before{ opacity:.92; }

    .cupTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      position:relative;
      z-index:1;
    }

    .cupIcon{
      width: 78px; height: 78px;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.18);
      box-shadow: 0 18px 60px rgba(0,0,0,.34), inset 0 1px 0 rgba(255,255,255,.10);
      overflow:hidden;
      flex: 0 0 auto;
    }
    .cupIcon img{ width:100%; height:100%; object-fit:cover; image-rendering: pixelated; transform: scale(1.02); }

    .cupStamp{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 18px 50px rgba(0,0,0,.26);
      font-size: 12px;
      opacity:.95;
      white-space:nowrap;
    }
    .miniDot{
      width: 10px; height: 10px;
      border-radius: 3px;
      background: rgba(255,255,255,.65);
      border: 1px solid rgba(255,255,255,.20);
      box-shadow: 0 0 18px rgba(61,243,255,.20);
    }

    .done .cupStamp{
      background: rgba(125,255,106,.14);
      border-color: rgba(125,255,106,.28);
      box-shadow: 0 0 0 3px rgba(125,255,106,.10), 0 18px 50px rgba(0,0,0,.28);
    }
    .done .miniDot{ background: rgba(125,255,106,.85); box-shadow: 0 0 18px rgba(125,255,106,.35); }

    .cupTitle{ display:flex; flex-direction:column; gap: 6px; padding: 0 2px; position:relative; z-index:1; }
    .cupTitle .t{ font-size: 16px; letter-spacing: 1px; color: rgba(255,255,255,.95); line-height: 1.1; }
    .cupTitle .s{ font-size: 12px; opacity:.82; color: rgba(255,255,255,.88); line-height: 1.35; }

    .cupFooter{
      display:flex; justify-content:space-between; align-items:center;
      font-size: 12px; opacity:.86; color: rgba(255,255,255,.86);
      position:relative; z-index:1;
      margin-top: 2px;
    }

    /* ===================== Modal ===================== */
    .overlay{
      position:fixed; inset:0;
      display:none;
      align-items:center; justify-content:center;
      padding: 18px;
      background: rgba(0,0,0,.72);
      z-index: 9999;
    }
    .overlay.show{ display:flex; }

    .modal{
      width: min(1060px, 100%);
      height: min(720px, 86vh);
      border-radius: var(--r3);
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      backdrop-filter: blur(14px);
      box-shadow: 0 52px 150px rgba(0,0,0,.66);
      overflow:hidden;
      position:relative;
      transform: translateY(16px) scale(.985);
      opacity:0;
      animation: pop 260ms var(--easeOut) forwards;
    }
    @keyframes pop{ to{ transform: translateY(0) scale(1); opacity:1; } }

    .modal::before{
      content:"";
      position:absolute; inset:-30%;
      background:
        radial-gradient(620px 480px at 25% 25%, rgba(61,243,255,.20), transparent 62%),
        radial-gradient(620px 480px at 78% 68%, rgba(255,210,90,.10), transparent 62%),
        radial-gradient(620px 480px at 70% 26%, rgba(255,79,165,.14), transparent 62%),
        radial-gradient(620px 480px at 48% 88%, rgba(125,255,106,.12), transparent 62%);
      filter: blur(28px);
      opacity:.95;
      animation: breathe 6s ease-in-out infinite alternate;
      pointer-events:none;
    }

    .modalInner{
      position:relative;
      z-index:1;
      height:100%;
      display:grid;
      grid-template-rows: auto 1fr auto;
      gap: 12px;
      padding: 16px;
    }

    .modalHeader{
      border-radius: var(--r2);
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.20);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.08);
      padding: 14px 14px 12px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
    }

    .modalTitle{ display:flex; flex-direction:column; gap: 8px; min-width:0; }
    .modalTitle h2{
      margin:0;
      font-size: 18px;
      letter-spacing: 1px;
      color: rgba(255,255,255,.95);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .metaRow{ display:flex; flex-wrap:wrap; gap: 10px; align-items:center; font-size: 12px; opacity:.92; }
    .pill2{
      display:inline-flex;
      gap: 8px;
      align-items:center;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 18px 50px rgba(0,0,0,.25);
      user-select:none;
      white-space:nowrap;
    }

    .closeBtn{
      font-weight: 900;
      letter-spacing:.8px;
      font-size: 12px;
      color: rgba(255,255,255,.92);
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      border-bottom-width: 2px;
      border-radius: 16px;
      padding: 10px 12px;
      cursor:pointer;
      user-select:none;
      backdrop-filter: blur(10px);
      box-shadow: 0 18px 50px rgba(0,0,0,.25);
      transition: transform 120ms ease, filter 120ms ease;
      min-width: 140px;
    }
    .closeBtn:active{ transform: translateY(1px); filter: brightness(.99); }

    .modalBody{
      border-radius: var(--r3);
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.08);
      box-shadow: 0 34px 100px rgba(0,0,0,.34), inset 0 1px 0 rgba(255,255,255,.08);
      overflow:hidden;
      position:relative;
    }

    .paper{
      height:100%;
      padding: 16px;
      display:grid;
      grid-template-rows: auto 1fr;
      gap: 12px;
    }

    .paperTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 12px;
      font-size: 12px;
      opacity:.90;
    }

    .paperBox{
      height:100%;
      border-radius: var(--r2);
      background: var(--paper);
      border: 2px solid rgba(0,0,0,.18);
      box-shadow: 0 26px 80px rgba(0,0,0,.34), inset 0 1px 0 rgba(255,255,255,.65);
      padding: 14px;
      position:relative;
      overflow:hidden;
      transform-origin: 50% 50%;
      animation: paperFloat 5.2s ease-in-out infinite alternate;
    }
    @keyframes paperFloat{
      0%{ transform: translateY(0); }
      100%{ transform: translateY(-4px); }
    }
    .paperBox::before{
      content:"";
      position:absolute; inset:0;
      background: radial-gradient(rgba(0,0,0,.08) 1px, transparent 1px);
      background-size: 10px 10px;
      opacity:.18;
      mix-blend-mode: multiply;
      pointer-events:none;
    }

    .typed{
      position:relative;
      z-index:1;
      white-space: pre-wrap;
      font-size: 14px;
      line-height: 1.7;
      color: var(--ink);
    }

    .twinRow{
      margin-top: 14px;
      display:none;
      gap: 12px;
      flex-wrap:wrap;
      align-items:flex-start;
      position:relative;
      z-index:1;
    }
    .twinSquare{
      width: 180px;
      height: 180px;
      border-radius: 18px;
      border: 2px solid rgba(0,0,0,.18);
      background: rgba(255,255,255,.96);
      box-shadow: 0 26px 70px rgba(0,0,0,.30), inset 0 1px 0 rgba(255,255,255,.65);
      overflow:hidden;
    }
    .twinSquare img{ width:100%; height:100%; object-fit:cover; image-rendering: pixelated; }

    .modalFooter{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 6px 2px 0;
    }
    .footerNote{
      font-size: 12px;
      opacity:.88;
      color: rgba(255,255,255,.88);
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap:wrap;
    }

    .btn{
      font-weight: 900;
      letter-spacing:.9px;
      font-size: 12px;
      color: rgba(0,0,0,.92);
      background:
        linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.80)),
        linear-gradient(180deg, rgba(61,243,255,.25), rgba(61,243,255,.10));
      border: 1px solid rgba(0,0,0,.18);
      border-bottom-width: 2px;
      border-radius: 18px;
      padding: 12px 14px;
      cursor:pointer;
      user-select:none;
      box-shadow: 0 22px 66px rgba(0,0,0,.38), 0 0 0 3px rgba(61,243,255,.10);
      transition: transform 120ms ease, filter 120ms ease;
      min-width: 150px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
    }
    .btn:active{ transform: translateY(1px); filter: brightness(.99); }

    .btnGhost{
      color: rgba(255,255,255,.92);
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      border-bottom-width: 2px;
      box-shadow: 0 22px 56px rgba(0,0,0,.32);
      backdrop-filter: blur(10px);
    }

    /* ===================== Thinking Overlay (micro) ===================== */
    .thinking{
      position:absolute; inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      background: rgba(0,0,0,.45);
      z-index: 6;
    }
    .thinking.show{ display:flex; }
    .thinkCard{
      width: min(360px, 88%);
      border-radius: var(--r3);
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.16);
      backdrop-filter: blur(14px);
      box-shadow: 0 40px 120px rgba(0,0,0,.50);
      padding: 16px;
      text-align:center;
    }
    .thinkCard .t1{ margin:0 0 6px 0; font-size: 14px; letter-spacing: 1px; color: rgba(255,255,255,.95); }
    .thinkCard .t2{ margin:0; font-size: 12px; opacity:.88; color: rgba(255,255,255,.90); }
    .dots{ display:flex; justify-content:center; gap: 8px; margin-top: 12px; }
    .dp{
      width: 10px; height: 10px; border-radius: 3px;
      background: rgba(255,255,255,.72);
      border: 1px solid rgba(255,255,255,.16);
      box-shadow: 0 0 18px rgba(61,243,255,.25);
      animation: dp 700ms infinite ease-in-out;
    }
    .dp:nth-child(2){ animation-delay: 120ms; }
    .dp:nth-child(3){ animation-delay: 240ms; }
    @keyframes dp{
      0%,100%{ transform: translateY(0); opacity:.55; }
      50%{ transform: translateY(-6px); opacity:1; }
    }

    /* ===================== Game Area ===================== */
    .gameArea{ margin-top: 14px; display:none; gap: 10px; flex-direction:column; position:relative; z-index:1; }
    .gStats{
      display:flex; gap: 10px; flex-wrap:wrap;
      align-items:center; justify-content:space-between;
      font-size: 12px; color: rgba(0,0,0,.85);
    }
    .gChip{
      padding: 8px 10px; border-radius: 999px;
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(0,0,0,.16);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.65);
      white-space:nowrap;
    }
    #jumpGame{
      width: 100%;
      height: 320px;
      border-radius: var(--r2);
      border: 2px solid rgba(0,0,0,.18);
      background: linear-gradient(180deg, #e9f6ff, #cfeaff);
      box-shadow: 0 26px 80px rgba(0,0,0,.28), inset 0 1px 0 rgba(255,255,255,.65);
      image-rendering: pixelated;
      display:block;
    }
    .gHint{ font-size: 12px; color: rgba(0,0,0,.88); line-height:1.55; opacity:.95; }

    /* ===================== Victory ===================== */
    .victory{
      position:fixed; inset:0;
      display:none;
      align-items:center; justify-content:center;
      padding: 18px;
      background: rgba(0,0,0,.80);
      z-index: 10000;
    }
    .victory.show{ display:flex; }

    .vicCard{
      width: min(1060px, 100%);
      height: min(720px, 86vh);
      border-radius: var(--r3);
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      backdrop-filter: blur(14px);
      box-shadow: 0 56px 160px rgba(0,0,0,.70);
      overflow:hidden;
      position:relative;
    }
    .vicCard::before{
      content:"";
      position:absolute; inset:-30%;
      background:
        radial-gradient(620px 520px at 25% 30%, rgba(125,255,106,.18), transparent 62%),
        radial-gradient(620px 520px at 80% 40%, rgba(61,243,255,.16), transparent 62%),
        radial-gradient(620px 520px at 55% 85%, rgba(255,210,90,.12), transparent 62%);
      filter: blur(30px);
      opacity:.95;
      animation: breathe 6s ease-in-out infinite alternate;
      pointer-events:none;
    }

    .vicInner{
      position:relative; z-index:1;
      height:100%;
      display:grid;
      grid-template-rows: auto 1fr auto;
      gap: 14px;
      padding: 16px;
    }
    .vicTop{
      border-radius: var(--r2);
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.08);
      padding: 14px 14px 12px;
      display:flex; align-items:center; justify-content:space-between; gap: 12px;
    }
    .vicTop h2{ margin:0; font-size: 18px; letter-spacing: 1px; color: rgba(255,255,255,.95); }

    .vicBody{
      border-radius: var(--r3);
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.08);
      box-shadow: 0 34px 110px rgba(0,0,0,.34), inset 0 1px 0 rgba(255,255,255,.08);
      display:grid;
      place-items:center;
      padding: 18px;
      position:relative;
      overflow:hidden;
    }
    .vicPaper{
      width: min(780px, 96%);
      border-radius: var(--r3);
      background: rgba(255,255,255,.92);
      border: 2px solid rgba(0,0,0,.18);
      box-shadow: 0 36px 130px rgba(0,0,0,.44), inset 0 1px 0 rgba(255,255,255,.65);
      padding: 18px;
      text-align:center;
      position:relative;
      overflow:hidden;
      color: rgba(0,0,0,.92);
      animation: popIn 520ms var(--easeOut) both;
    }
    .vicPaper::before{
      content:"";
      position:absolute; inset:0;
      background: radial-gradient(rgba(0,0,0,.08) 1px, transparent 1px);
      background-size: 10px 10px;
      opacity:.18;
      mix-blend-mode: multiply;
      pointer-events:none;
    }
    .vicMsg{ position:relative; z-index:1; margin: 0; font-size: 16px; line-height: 1.7; white-space: pre-wrap; }

    #confetti{
      position:absolute; inset:0;
      pointer-events:none;
      opacity:.95;
    }

    /* Focus visible */
    .startBtn:focus-visible, .btnSmall:focus-visible, .cupBtn:focus-visible, .btn:focus-visible, .closeBtn:focus-visible{
      outline: 3px solid rgba(61,243,255,.55);
      outline-offset: 4px;
    }

    /* ============================================================
       MOBILE PATCH (Layout + bessere Scale)
       + Touch fix fürs Game (kein Scroll/Zoom beim Tippen)
    ============================================================ */

    /* iOS: safer viewport (dynamic address bar) */
    .stage{
      height: min(780px, 92dvh);
    }

    /* Game touches: kein double-tap zoom / scroll jank */
    #jumpGame, #gameArea{
      touch-action: manipulation;
    }

    /* Mobile Layout: kompakter, weniger „fett“, besser verteilt */
  @media (max-width: 720px){
  .app{ padding: 10px; }

  /* Stage: iOS Adressleiste + safe area */
  .stage{
    height: calc(100dvh - 20px);
    border-radius: 22px;
  }

  .screen{ padding: 12px; }

  /* HUB oben kompakter */
  .hubTop{
    flex-direction: column;
    align-items: stretch;
    gap: 10px;
    margin-bottom: 12px;
  }

  .hudLeft{ min-width: 0; }
  .hudTitle{ gap: 8px; }

  .pill{
    font-size: 11px;
    padding: 7px 9px;
  }

  .bar{ width: 100%; height: 10px; }

  /* Buttons: auf Mobile sauber */
  .hudRight{
    width: 100%;
    flex-direction: row;
    align-items: stretch;
    gap: 10px;
  }

  .btnSmall{
    width: 100%;
    min-width: 0;
    padding: 10px 10px;
    border-radius: 16px;
  }

  /* GridWrap: NICHT quetschen -> lieber smooth scroll */
  .gridWrap{
    padding: 12px;
    border-radius: 22px;

    /* statt height: calc(100% - 128px); */
    height: auto;

    /* wichtig: nur dieser Bereich scrollt */
    max-height: calc(100dvh - 250px - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px));
    overflow: auto;
    -webkit-overflow-scrolling: touch;

    /* unten etwas Luft wegen iPhone Homebar */
    padding-bottom: calc(12px + env(safe-area-inset-bottom, 0px));
  }

  /* Cups: 1 Spalte, sauberer Abstand */
  .cups{
    grid-template-columns: 1fr !important;
    gap: 12px;
  }

  .cupBtn{
    padding: 12px;
    border-radius: 20px;
    gap: 10px;
  }

  .cupIcon{
    width: 64px;
    height: 64px;
    border-radius: 18px;
  }

  .cupTitle .t{ font-size: 15px; }
  .cupTitle .s{ font-size: 11px; }

  /* Modal: mehr usable space */
  .overlay{ padding: 10px; }

  .modal{
    height: calc(92dvh - env(safe-area-inset-top, 0px));
    border-radius: 22px;
  }

  .modalInner{ padding: 12px; gap: 10px; }
  .paper{ padding: 12px; }
  .paperBox{ padding: 12px; }
  .typed{ font-size: 14px; line-height: 1.75; }

  .modalFooter{
    flex-direction: column;
    align-items: stretch;
    gap: 10px;
  }

  .modalFooter > div:last-child{
    width: 100%;
    justify-content: space-between;
  }

  .btn{
    width: 100%;
    min-width: 0;
    padding: 12px 12px;
    border-radius: 18px;
  }

  /* Game area height (dein Fix bleibt) */
  #jumpGame{
    height: 260px;
  }
}

/* Extra: ganz kleine Handys -> Buttons untereinander */
@media (max-width: 420px){
  .hudRight{ flex-direction: column; }
}
  </style>
</head>

<body>
  <div class="bgFX" aria-hidden="true">
    <div class="grid"></div>
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="blob b3"></div>
    <div class="stars" id="stars"></div>
    <div class="scan"></div>
    <div class="grain"></div>
  </div>

  <div class="app px">
    <div class="stage" id="stage">

      <!-- START SCREEN -->
      <section class="screen show" id="screenStart" aria-label="Start Screen">
        <div class="start">
          <video class="startVideo" id="startVideo" muted playsinline loop preload="metadata">
            <source src="Mario Kart DS - Rainbow Road.mp4" type="video/mp4" />
          </video>
          <div class="startOverlay"></div>

          <div class="startCard px">
            <div class="logo">
              <h1><span class="accent">TWIN</span> KART DS</h1>
              <div class="subPills">
                <span class="pill"><span class="dot"></span> Nostalgie One-Sider</span>
                <span class="pill"><span class="dot"></span> Music: <span class="kbd">M</span></span>
                <span class="pill"><span class="dot"></span> Reset: <span class="kbd">R</span></span>
              </div>

              <button class="startBtn px" id="btnStart" type="button">START ▶</button>
              <p class="hint px">Tipp: <span class="kbd">Enter</span> geht auch • Musik startet erst nach START</p>
            </div>
          </div>
        </div>
      </section>

      <!-- HUB SCREEN -->
      <section class="screen" id="screenHub" aria-label="Cups Screen">
        <div class="hubTop">
          <div class="hudLeft">
            <div class="hudTitle">
              <span class="pill"><span class="dot"></span><span id="progText">Fortschritt: 0 / 0</span></span>
              <span class="pill"><span class="dot"></span><span id="musicText">Music: AUS</span></span>
              <span class="pill"><span class="dot"></span><span>Keys: <span class="kbd">1..9</span></span></span>
            </div>
            <div class="bar"><div class="fill" id="progFill"></div></div>
          </div>

          <div class="hudRight">
            <button class="btnSmall px" id="btnMusic" type="button">MUSIC TOGGLE (M)</button>
            <button class="btnSmall px" id="btnReset" type="button">RESET (R)</button>
          </div>
        </div>

        <div class="gridWrap">
          <div class="cups" id="cups"></div>
        </div>
      </section>
    </div>
  </div>

  <!-- MODAL -->
  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modalInner">
        <div class="modalHeader">
          <div class="modalTitle">
            <h2 id="modalTitle">Titel</h2>
            <div class="metaRow">
              <span class="pill2"><span class="dot"></span><span id="metaStep">1 / 1</span></span>
              <span class="pill2"><span class="dot"></span><span id="metaType">TEXT</span></span>
              <span class="pill2"><span class="dot"></span><span id="metaStatus">Status: offen</span></span>
            </div>
          </div>
          <button class="closeBtn px" id="btnBeendenTop" type="button">BEENDEN ✕</button>
        </div>

        <div class="modalBody">
          <div class="paper">
            <div class="paperTop">
              <div id="typeHint">Satz wird getippt… (klick/Enter = sofort fertig)</div>
              <div>Keys: <span class="kbd">Enter</span> / <span class="kbd">Esc</span></div>
            </div>

            <div class="paperBox" id="paperBox">
              <div class="typed px" id="typed"></div>

              <div class="twinRow" id="twinRow">
                <div class="twinSquare" id="twinSquare">
                  <img id="twinImg" src="twin.png" alt="twin.png" />
                </div>
              </div>

              <div class="gameArea" id="gameArea">
                <div class="gStats">
                  <span class="gChip">Score: <b id="gScore">0</b></span>
                  <span class="gChip">Best: <b id="gBest">0</b></span>
                  <span class="gChip">Status: <b id="gState">READY</b></span>
                </div>
                <canvas id="jumpGame" width="980" height="420"></canvas>
                <div class="gHint px">
                  <b>Steuerung:</b> Space / ↑ / Klick = springen • Crash = Game Over • Restart: Space/↑/Klick<br>
                  Runner ist „67“.
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="modalFooter">
          <div class="footerNote">
            <span class="pill2"><span class="dot"></span> WEITER erscheint nur, wenn es mehr als 1 Satz gibt</span>
          </div>
          <div style="display:flex; gap:10px; align-items:center;">
            <button class="btn btnGhost px" id="btnBeenden" type="button">BEENDEN</button>
            <button class="btn px" id="btnWeiter" type="button">WEITER</button>
          </div>
        </div>

        <div class="thinking" id="thinking">
          <div class="thinkCard px">
            <p class="t1">Thinking…</p>
            <p class="t2">lade den Moment…</p>
            <div class="dots" aria-hidden="true">
              <div class="dp"></div><div class="dp"></div><div class="dp"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- VICTORY -->
  <div class="victory" id="victory" aria-hidden="true">
    <div class="vicCard" role="dialog" aria-modal="true" aria-labelledby="vicTitle">
      <canvas id="confetti" width="1200" height="700"></canvas>
      <div class="vicInner">
        <div class="vicTop">
          <h2 class="px" id="vicTitle">CUP GEWONNEN</h2>
          <button class="closeBtn px" id="btnVictoryClose" type="button">BEENDEN ✕</button>
        </div>

        <div class="vicBody">
          <div class="vicPaper px">
            <p class="vicMsg" id="vicMsg">Bilcan glückwunsch du hast Den Cup gewonnen</p>
          </div>
        </div>

        <div class="footerNote" style="padding:0 6px 8px; opacity:.92;">
          Tipp: <span class="kbd">R</span> reset • <span class="kbd">M</span> music
        </div>
      </div>
    </div>
  </div>

  <!-- Background Music -->
  <audio id="bgm" src="rainbowRoad.mp3" loop preload="auto"></audio>

  <script>
    /* ============================================================
      DATA — your texts (minimal changes, only sentence splitting)
    ============================================================ */
    const ITEMS = [
      { id:"nonchalant", title:"nonchalant", subtitle:"erste encounter vibes…", icon:"nonchalant.jpg", type:"text",
        segments:[
          "Als wir uns das erste mal encounterd sind und ich dich gekonnt ignoriert habe und kaum wahrgenommen habe.",
          "Du  hast du mich für nonchalant gehalten ,"
        ]
      },
      { id:"sideeye", title:"sideeye", subtitle:"67 konnte ich nicht ab…", icon:"sideeye.jpg", type:"text",
        segments:[
          "da dachtest du ich bin ne zicke (ich konnte 67 nicht ab ).",
          "Von wo soll ich wissen das du noch relevant sein wirst,"
        ]
      },
      { id:"birthday_twins", title:"birthday twins", subtitle:"mein geburtag wieder relevant…", icon:"twins.jpg", type:"text", showTwin:true,
        segments:[
          "Das war das erste mal das mein geburtag wieder relevant war.",
          "(du hypersenible).",
          "schätze lowkey das du mein caretaken im Krativlabor apprecieates.",
          "manchmal  hinterfrage ich nicht aber checke wie du dich fühlst (glaub ich zu mindestens ) ,"
        ]
      },
      { id:"toad_yoshi", title:"toad & yoshi", subtitle:"mario party duo…", icon:"toadyoshi.jpg", type:"text",
        segments:[
          "Wann kann man behaupten das man mit einer frau mario party gezockt hat auch wenn du das 1vs 1 gewonnen hast ,",
          "Mir hat unsere duo runde sehr spaß gemacht,"
        ]
      },
      { id:"sixseven", title:"67", subtitle:"six seveeeen…", icon:"67.jpg", type:"text",
        segments:[
          "six seveeeen (gott weiß wie weit es dazu kam das ich das jetzt sage),"
        ]
      },
      { id:"suessli", title:"süßli müsli", subtitle:"coole erinnerungen…", icon:"süslimüsli.jpg", type:"text",
        segments:[
          "Lowkey wir haben echt coole erinerungen zusammen,"
        ]
      },
      { id:"ss", title:"Sami und salma", subtitle:"düsseldorf promenade…", icon:"ss.jpg", type:"text",
        segments:[
          "Bin den beiden echt dankbar das wir so lachkik mit den beiden haben konnten .",
          "salma supa frau der kuchen war so bombe .",
          "und sami strammer bira (düsseldorf  promenade).",
          "mit dir chill ich gern ich einem auto und guck dennen zu wie die wie kinder spaß haben auf einem parkplatz ,"
        ]
      },
      { id:"tishtennis", title:"tishtennis", subtitle:"schläger beansprucht…", icon:"tischtennis.jpg", type:"text",
        segments:[
          "hast meienen schläger beansprucht"
        ]
      },
      { id:"tortuga", title:"Tortuga-Cup", subtitle:"67 Jump Game", icon:"tortuga.jpg", type:"game",
        segments:[
          "hier kommt das game von vorhin also 67 jumpen wie dieser dino von google"
        ]
      },
    ];

    /* ============================================================
      Storage
    ============================================================ */
    const KEY_PROGRESS = "twinkart_progress_final_v1";
    const KEY_GAMEBEST = "twinkart_jump_best_final_v1";
    const KEY_SETTINGS = "twinkart_settings_final_v1";

    const state = {
      started: false,
      openId: null,
      segIndex: 0,
      typing: false,
      skip: false,
      progress: {},
      musicOn: true,
      gameTouched: false
    };

    function load(){
      try{ const p = localStorage.getItem(KEY_PROGRESS); if(p) state.progress = JSON.parse(p) || {}; }catch(e){}
      try{
        const s = localStorage.getItem(KEY_SETTINGS);
        if(s){
          const o = JSON.parse(s);
          if(o && typeof o === "object"){
            state.musicOn = !!o.musicOn;
          }
        }
      }catch(e){}
      try{
        const b = localStorage.getItem(KEY_GAMEBEST);
        if(b) game.best = parseInt(b,10) || 0;
      }catch(e){}
    }
    function saveProgress(){ localStorage.setItem(KEY_PROGRESS, JSON.stringify(state.progress)); }
    function saveSettings(){ localStorage.setItem(KEY_SETTINGS, JSON.stringify({musicOn: state.musicOn})); }

    /* ============================================================
      DOM
    ============================================================ */
    const starsEl = document.getElementById("stars");
    const screenStart = document.getElementById("screenStart");
    const screenHub = document.getElementById("screenHub");
    const btnStart = document.getElementById("btnStart");
    const startVideo = document.getElementById("startVideo");

    const cupsEl = document.getElementById("cups");
    const progText = document.getElementById("progText");
    const progFill = document.getElementById("progFill");

    const musicText = document.getElementById("musicText");
    const btnMusic = document.getElementById("btnMusic");
    const btnReset = document.getElementById("btnReset");

    const overlay = document.getElementById("overlay");
    const modalTitle = document.getElementById("modalTitle");
    const metaStep = document.getElementById("metaStep");
    const metaType = document.getElementById("metaType");
    const metaStatus = document.getElementById("metaStatus");
    const typedEl = document.getElementById("typed");
    const typeHint = document.getElementById("typeHint");
    const btnBeendenTop = document.getElementById("btnBeendenTop");
    const btnBeenden = document.getElementById("btnBeenden");
    const btnWeiter = document.getElementById("btnWeiter");
    const paperBox = document.getElementById("paperBox");
    const thinking = document.getElementById("thinking");

    const twinRow = document.getElementById("twinRow");
    const twinSquare = document.getElementById("twinSquare");
    const twinImg = document.getElementById("twinImg");

    const gameArea = document.getElementById("gameArea");
    const jumpCanvas = document.getElementById("jumpGame");
    const gScoreEl = document.getElementById("gScore");
    const gBestEl = document.getElementById("gBest");
    const gStateEl = document.getElementById("gState");

    const victory = document.getElementById("victory");
    const btnVictoryClose = document.getElementById("btnVictoryClose");
    const confettiCanvas = document.getElementById("confetti");
    const cctx = confettiCanvas.getContext("2d");

    const bgm = document.getElementById("bgm");

    /* ============================================================
      Helpers
    ============================================================ */
    const sleep = (ms)=>new Promise(r=>setTimeout(r,ms));
    const clamp = (v,a,b)=>Math.max(a,Math.min(b,v));

    function makeStars(){
      const W = window.innerWidth;
      const H = window.innerHeight;
      starsEl.innerHTML = "";
      const count = Math.min(140, Math.floor((W*H)/11500));
      for(let i=0;i<count;i++){
        const s = document.createElement("div");
        s.className = "star";
        s.style.left = (Math.random()*100) + "%";
        s.style.top  = (Math.random()*100) + "%";
        s.style.animationDuration = (2.0 + Math.random()*3.0) + "s";
        s.style.opacity = String(0.45 + Math.random()*0.55);
        starsEl.appendChild(s);
      }
    }

    function countDone(){
      return ITEMS.reduce((a,it)=>a + (state.progress[it.id] ? 1 : 0), 0);
    }
    function updateProgressUI(){
      const done = countDone();
      const total = ITEMS.length;
      progText.textContent = `Fortschritt: ${done} / ${total}`;
      progFill.style.width = total ? Math.round(done/total*100) + "%" : "0%";
    }

    function updateMusicUI(){
      musicText.textContent = "Music: " + (state.musicOn ? "AN" : "AUS");
    }

    function getItem(id){ return ITEMS.find(x=>x.id===id); }

    /* ============================================================
      Music (M toggle)
    ============================================================ */
    async function startMusicIfAllowed(){
      try{
        if(!state.musicOn){
          bgm.pause();
          return;
        }
        bgm.volume = 0.65;
        await bgm.play();
      }catch(e){
        // autoplay block is fine; user can press M or click toggle
      }
    }
    function setMusic(on){
      state.musicOn = !!on;
      saveSettings();
      updateMusicUI();
      if(!state.started) return;
      if(state.musicOn) startMusicIfAllowed();
      else bgm.pause();
    }
    function toggleMusic(){ setMusic(!state.musicOn); }
    btnMusic.addEventListener("click", toggleMusic);

    /* ============================================================
      Start -> Hub
    ============================================================ */
    function showHub(){
      screenStart.classList.remove("show");
      screenHub.classList.add("show");
      state.started = true;

      buildCups();
      updateProgressUI();
      updateMusicUI();

      startMusicIfAllowed();
    }

    btnStart.addEventListener("click", showHub);

    window.addEventListener("keydown", (e)=>{
      if(screenStart.classList.contains("show") && e.key === "Enter"){
        e.preventDefault();
        showHub();
      }
    });

    /* ============================================================
      Build Cups
    ============================================================ */
    function buildCups(){
      cupsEl.innerHTML = "";
      ITEMS.forEach((it, idx)=>{
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "cupBtn px";
        btn.style.animationDelay = (idx * 80) + "ms";
        btn.setAttribute("data-id", it.id);
        if(state.progress[it.id]) btn.classList.add("done");

        btn.innerHTML = `
          <div class="cupTop">
            <div class="cupIcon"><img alt="" /></div>
            <div class="cupStamp"><span class="miniDot"></span><span>${state.progress[it.id] ? "gesehen" : "offen"}</span></div>
          </div>
          <div class="cupTitle">
            <div class="t">${escapeHTML(it.title)}</div>
            <div class="s">${escapeHTML(it.subtitle || "")}</div>
          </div>
          <div class="cupFooter">
            <div>Öffnen</div>
            <div><span class="kbd">${idx+1}</span></div>
          </div>
        `;

        const img = btn.querySelector(".cupIcon img");
        img.src = it.icon;
        img.onerror = ()=>{ img.style.opacity = "0"; };

        btn.addEventListener("click", ()=> openModal(it.id));
        cupsEl.appendChild(btn);
      });
    }

    function refreshCups(){
      const btns = [...cupsEl.querySelectorAll(".cupBtn")];
      btns.forEach(b=>{
        const id = b.getAttribute("data-id");
        const done = !!state.progress[id];
        b.classList.toggle("done", done);
        const stamp = b.querySelector(".cupStamp span:last-child");
        if(stamp) stamp.textContent = done ? "gesehen" : "offen";
      });
      updateProgressUI();
    }

    function escapeHTML(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    /* ============================================================
      Modal
    ============================================================ */
    function showOverlay(){
      overlay.classList.add("show");
      overlay.setAttribute("aria-hidden","false");
    }
    function hideOverlay(){
      overlay.classList.remove("show");
      overlay.setAttribute("aria-hidden","true");
    }

    async function showThinking(ms=520){
      thinking.classList.add("show");
      await sleep(ms);
      thinking.classList.remove("show");
    }

    function openModal(id){
      const it = getItem(id);
      if(!it) return;

      state.openId = id;
      state.segIndex = 0;
      state.typing = false;
      state.skip = false;

      modalTitle.textContent = it.title;
      metaType.textContent = it.type === "game" ? "GAME" : "TEXT";
      metaStatus.textContent = state.progress[id] ? "Status: gesehen" : "Status: offen";

      typedEl.textContent = "";

      // twin image only on birthday twins
      twinRow.style.display = "none";
      twinSquare.style.display = "none";
      if(it.showTwin){
        twinRow.style.display = "flex";
        twinSquare.style.display = "block";
        twinImg.onerror = ()=>{ twinSquare.style.display = "none"; };
      }

      // game
      if(it.type === "game"){
        typeHint.textContent = "Jump Game — Space / ↑ / Klick = springen";
        gameArea.style.display = "flex";
        btnWeiter.style.display = "none";
      }else{
        typeHint.textContent = "Satz wird getippt… (klick/Enter = sofort fertig)";
        gameArea.style.display = "none";
      }

      showOverlay();
      playOpen();

      showThinking(560).then(()=>{
        if(it.type === "game"){
          typedEl.textContent = it.segments[0] || "";
          metaStep.textContent = `1 / 1`;
          metaStatus.textContent = "Status: spiel läuft";
          startGame();
        }else{
          typeCurrentSegment();
        }
      });
    }

    function closeModal(){
      stopGame();
      hideOverlay();
      state.openId = null;
      state.segIndex = 0;
      state.typing = false;
      state.skip = false;
      playClose();
      maybeVictory();
    }

    function canMarkDoneText(it){
      return (state.segIndex >= it.segments.length - 1) && !state.typing;
    }

    function finalizeProgress(){
      const it = getItem(state.openId);
      if(!it) return;

      if(it.type === "game"){
        if(state.gameTouched){
          state.progress[it.id] = true;
        }
      }else{
        if(canMarkDoneText(it)){
          state.progress[it.id] = true;
        }
      }
      saveProgress();
      refreshCups();
      metaStatus.textContent = state.progress[it.id] ? "Status: gesehen" : "Status: offen";
    }

    btnBeendenTop.addEventListener("click", ()=>{ finalizeProgress(); closeModal(); });
    btnBeenden.addEventListener("click", ()=>{ finalizeProgress(); closeModal(); });

    btnWeiter.addEventListener("click", ()=>{
      const it = getItem(state.openId);
      if(!it || it.type !== "text") return;

      if(state.typing){
        state.skip = true;
        playSkip();
        return;
      }
      if(state.segIndex < it.segments.length - 1){
        state.segIndex++;
        playNext();
        typeCurrentSegment();
      }
    });

    paperBox.addEventListener("click", ()=>{
      const it = getItem(state.openId);
      if(!it || it.type !== "text") return;
      if(state.typing){
        state.skip = true;
        playSkip();
      }
    });

    async function typeCurrentSegment(){
      const it = getItem(state.openId);
      if(!it || it.type !== "text") return;

      const total = it.segments.length;
      metaStep.textContent = `${state.segIndex + 1} / ${total}`;

      const hasMore = state.segIndex < total - 1;
      btnWeiter.style.display = hasMore ? "inline-flex" : "none";

      const seg = it.segments[state.segIndex] || "";
      typedEl.textContent = "";
      state.typing = true;
      state.skip = false;

      const baseDelay = 13;
      const extra = 26;

      for(let i=0;i<seg.length;i++){
        if(state.skip){
          typedEl.textContent = seg;
          break;
        }
        typedEl.textContent += seg[i];
        playTypeTick(i);
        const ch = seg[i];
        const d = baseDelay + (ch===" " ? 7 : 0) + (Math.random()*extra);
        await sleep(d);
      }
      state.typing = false;

      metaStatus.textContent = hasMore ? "Status: weiter verfügbar" : "Status: bereit zum beenden";
    }

    /* ============================================================
      Keys
    ============================================================ */
    window.addEventListener("keydown", (e)=>{
      const k = e.key.toLowerCase();

      // music toggle everywhere
      if(k === "m"){
        e.preventDefault();
        toggleMusic();
        return;
      }

      // reset
      if(k === "r"){
        e.preventDefault();
        doReset();
        return;
      }

      // victory close
      if(victory.classList.contains("show")){
        if(k === "escape" || k === "enter" || k === " "){
          e.preventDefault();
          hideVictory();
          playClose();
        }
        return;
      }

      // open cups by number (only on hub, not in modal)
      if(state.started && !overlay.classList.contains("show")){
        if(/^[1-9]$/.test(k)){
          const idx = parseInt(k,10) - 1;
          const it = ITEMS[idx];
          if(it) openModal(it.id);
        }
        return;
      }

      // modal behavior
      if(overlay.classList.contains("show")){
        const it = getItem(state.openId);
        if(!it) return;

        if(k === "escape"){
          e.preventDefault();
          finalizeProgress();
          closeModal();
          return;
        }

        if(it.type === "text" && k === "enter"){
          e.preventDefault();
          if(state.typing){
            state.skip = true;
            playSkip();
          }else{
            if(state.segIndex < it.segments.length - 1){
              btnWeiter.click();
            }
          }
        }

        if(it.type === "game"){
          if(k === " " || k === "arrowup"){
            e.preventDefault();
            jump();
          }
        }
      }
    });

    btnReset.addEventListener("click", doReset);

    function doReset(){
      const ok = confirm("Reset wirklich? (Fortschritt + Bestscore werden gelöscht)");
      if(ok){
        state.progress = {};
        state.gameTouched = false;
        localStorage.removeItem(KEY_PROGRESS);
        localStorage.removeItem(KEY_GAMEBEST);
        refreshCups();
        hideVictory();
        playClose();
      }else{
        playClose();
      }
    }

    /* ============================================================
      Victory + confetti
    ============================================================ */
    let confettiRAF = null;
    let confettiParts = [];

    function resizeConfetti(){
      const rect = confettiCanvas.getBoundingClientRect();
      const dpr = Math.min(2, window.devicePixelRatio || 1);
      confettiCanvas.width = Math.floor(rect.width * dpr);
      confettiCanvas.height = Math.floor(rect.height * dpr);
      cctx.setTransform(dpr,0,0,dpr,0,0);
    }

    function startConfetti(){
      resizeConfetti();
      confettiParts = [];
      const rect = confettiCanvas.getBoundingClientRect();
      const W = rect.width, H = rect.height;

      for(let i=0;i<170;i++){
        confettiParts.push({
          x: Math.random()*W,
          y: -20 - Math.random()*H,
          vx: -0.7 + Math.random()*1.4,
          vy: 1.6 + Math.random()*3.6,
          w: 3 + Math.random()*6,
          h: 2 + Math.random()*4,
          t: Math.random()*Math.PI*2,
          a: 0.65 + Math.random()*0.35
        });
      }

      const tick = ()=>{
        const r = confettiCanvas.getBoundingClientRect();
        const W2 = r.width, H2 = r.height;
        cctx.clearRect(0,0,W2,H2);

        confettiParts.forEach(p=>{
          p.x += p.vx;
          p.y += p.vy;
          p.t += 0.08;

          if(p.y > H2 + 30){
            p.y = -20;
            p.x = Math.random()*W2;
          }
          const wob = Math.sin(p.t)*2;
          cctx.globalAlpha = p.a;
          const hue = (p.t * 60) % 360;
          cctx.fillStyle = `hsla(${hue}, 92%, 65%, 0.95)`;
          cctx.fillRect(p.x + wob, p.y, p.w, p.h);
        });

        cctx.globalAlpha = 1;
        confettiRAF = requestAnimationFrame(tick);
      };

      if(confettiRAF) cancelAnimationFrame(confettiRAF);
      confettiRAF = requestAnimationFrame(tick);
    }

    function stopConfetti(){
      if(confettiRAF) cancelAnimationFrame(confettiRAF);
      confettiRAF = null;
      const r = confettiCanvas.getBoundingClientRect();
      cctx.clearRect(0,0,r.width,r.height);
    }

    function showVictory(){
      victory.classList.add("show");
      victory.setAttribute("aria-hidden","false");
      playWin();
      startConfetti();
    }

    function hideVictory(){
      victory.classList.remove("show");
      victory.setAttribute("aria-hidden","true");
      stopConfetti();
    }

    btnVictoryClose.addEventListener("click", ()=>{ hideVictory(); playClose(); });

    function maybeVictory(){
      if(countDone() === ITEMS.length){
        showVictory();
      }
    }

    /* ============================================================
      Sounds (WebAudio, pixel-ish)
    ============================================================ */
    let audioCtx = null;
    function ensureAudio(){
      if(!audioCtx){
        const Ctx = window.AudioContext || window.webkitAudioContext;
        if(!Ctx) return null;
        audioCtx = new Ctx();
      }
      if(audioCtx.state === "suspended"){
        audioCtx.resume().catch(()=>{});
      }
      return audioCtx;
    }

    function tone({type="square", f=440, d=0.06, v=0.06, slide=null}={}){
      const ctx = ensureAudio();
      if(!ctx) return;
      const t0 = ctx.currentTime;
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type = type;
      o.frequency.setValueAtTime(f, t0);
      if(slide) o.frequency.exponentialRampToValueAtTime(slide, t0 + d);
      g.gain.setValueAtTime(0.0001, t0);
      g.gain.exponentialRampToValueAtTime(v, t0 + 0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, t0 + d);
      o.connect(g); g.connect(ctx.destination);
      o.start(t0); o.stop(t0 + d + 0.02);
    }

    function playOpen(){ tone({type:"triangle", f:520, d:0.08, v:0.06, slide:760}); setTimeout(()=>tone({type:"square", f:760, d:0.06, v:0.05, slide:980}), 60); }
    function playClose(){ tone({type:"square", f:260, d:0.08, v:0.05, slide:180}); }
    function playNext(){ tone({type:"triangle", f:700, d:0.06, v:0.06, slide:920}); }
    function playSkip(){ tone({type:"sine", f:820, d:0.04, v:0.04, slide:740}); }
    function playTypeTick(i){ if(i % 2 !== 0) return; tone({type:"square", f: (420 + (i%12)*12), d:0.02, v:0.008}); }
    function playWin(){
      tone({type:"triangle", f:523, d:0.10, v:0.06});
      setTimeout(()=>tone({type:"triangle", f:659, d:0.10, v:0.06}), 90);
      setTimeout(()=>tone({type:"triangle", f:784, d:0.12, v:0.07}), 180);
      setTimeout(()=>tone({type:"square", f:1046, d:0.14, v:0.07}), 280);
    }

    /* ============================================================
      Tortuga Jump Game (67)
    ============================================================ */
    const game = {
      ctx: jumpCanvas.getContext("2d"),
      running:false,
      over:false,
      t:0,
      score:0,
      best:0,
      x:120,
      y:0,
      vy:0,
      onGround:true,
      groundY: 320,
      speed: 6.2,
      spawn: 0,
      obstacles: [],
      raf:null
    };

    function loadBest(){
      try{
        const b = localStorage.getItem(KEY_GAMEBEST);
        game.best = b ? (parseInt(b,10) || 0) : 0;
      }catch(e){ game.best = 0; }
      gBestEl.textContent = String(game.best);
    }
    function saveBest(){ localStorage.setItem(KEY_GAMEBEST, String(game.best)); }

    function startGame(){
      loadBest();
      state.gameTouched = false;
      game.running = true;
      game.over = false;
      game.t = performance.now();
      game.score = 0;
      game.speed = 6.2;
      game.spawn = 0.9;
      game.obstacles = [];
      game.y = game.groundY;
      game.vy = 0;
      game.onGround = true;

      gScoreEl.textContent = "0";
      gStateEl.textContent = "RUN";

      if(game.raf) cancelAnimationFrame(game.raf);
      game.raf = requestAnimationFrame(loopGame);
    }

    function stopGame(){
      game.running = false;
      if(game.raf) cancelAnimationFrame(game.raf);
      game.raf = null;
      gStateEl.textContent = "STOP";
    }

    function loopGame(now){
      const dt = Math.min(0.033, (now - game.t)/1000);
      game.t = now;

      updateGame(dt);
      renderGame();

      if(game.running){
        game.raf = requestAnimationFrame(loopGame);
      }
    }

    function updateGame(dt){
      if(!game.running) return;

      game.speed += dt * 0.35;

      game.score += dt * 60;
      if(game.score >= 1) state.gameTouched = true;
      gScoreEl.textContent = String(Math.floor(game.score));

      const g = 1900;
      game.vy += g * dt;
      game.y += game.vy * dt;

      if(game.y >= game.groundY){
        game.y = game.groundY;
        game.vy = 0;
        game.onGround = true;
      }

      game.spawn -= dt;
      if(game.spawn <= 0){
        game.spawn = 0.85 + Math.random()*0.55;
        const h = 34 + Math.random()*28;
        const w = 18 + Math.random()*18;
        game.obstacles.push({ x: 980 + 60, y: game.groundY, w, h });
      }

      const vx = game.speed * 70 * dt;
      for(const o of game.obstacles){ o.x -= vx; }
      game.obstacles = game.obstacles.filter(o => o.x > -80);

      const px = game.x, py = game.y;
      const pW = 46, pH = 52;

      for(const o of game.obstacles){
        const hit =
          (px < o.x + o.w) &&
          (px + pW > o.x) &&
          (py - pH < o.y) &&
          (py > o.y - o.h);

        if(hit){ gameOver(); break; }
      }
    }

    function gameOver(){
      game.running = false;
      game.over = true;
      gStateEl.textContent = "GAME OVER";
      playClose();

      const s = Math.floor(game.score);
      if(s > game.best){
        game.best = s;
        gBestEl.textContent = String(game.best);
        saveBest();
        playNext();
      }
      // allow marking as done even if only a short run happened
      state.gameTouched = true;
    }

    function jump(){
      const it = getItem(state.openId);
      if(!it || it.type !== "game") return;

      if(game.over){
        playOpen();
        startGame();
        return;
      }
      if(game.onGround){
        game.onGround = false;
        game.vy = -740;
        tone({type:"triangle", f:520, d:0.06, v:0.05, slide:760});
      }
    }

    // Jump: Canvas + kompletter Game-Bereich (auch auf Mobile zuverlässig)
    jumpCanvas.addEventListener("pointerdown", (e)=>{
      e.preventDefault();
      jump();
    });

    gameArea.addEventListener("pointerdown", (e)=>{
      e.preventDefault();
      jump();
    });

    // iOS Safari: manchmal extra nötig
    gameArea.addEventListener("touchstart", (e)=>{
      e.preventDefault();
      jump();
    }, { passive:false });

    function renderGame(){
      const ctx = game.ctx;
      const W = jumpCanvas.width;
      const H = jumpCanvas.height;
      ctx.clearRect(0,0,W,H);

      // sky
      const grd = ctx.createLinearGradient(0,0,0,H);
      grd.addColorStop(0, "#e9f6ff");
      grd.addColorStop(1, "#cfeaff");
      ctx.fillStyle = grd;
      ctx.fillRect(0,0,W,H);

      // horizon line
      ctx.globalAlpha = 0.22;
      ctx.fillStyle = "#0b1030";
      ctx.fillRect(0, 210, W, 2);
      ctx.globalAlpha = 1;

      // ground
      ctx.fillStyle = "#6f7a88";
      ctx.fillRect(0, game.groundY, W, H - game.groundY);
      ctx.fillStyle = "rgba(0,0,0,0.25)";
      ctx.fillRect(0, game.groundY, W, 4);

      // obstacles
      for(const o of game.obstacles){
        ctx.fillStyle = "#ff4fa5";
        ctx.strokeStyle = "rgba(0,0,0,0.35)";
        ctx.lineWidth = 6;
        ctx.fillRect(o.x, o.y - o.h, o.w, o.h);
        ctx.strokeRect(o.x, o.y - o.h, o.w, o.h);
        ctx.fillStyle = "rgba(255,255,255,0.22)";
        ctx.fillRect(o.x + 4, o.y - o.h + 6, Math.max(4, o.w*0.25), 10);
      }

      // runner 67
      drawRunner67(ctx, game.x, game.y);

      // scanlines
      ctx.globalAlpha = 0.12;
      ctx.fillStyle = "#000";
      for(let y=0;y<H;y+=6){ ctx.fillRect(0,y,W,1); }
      ctx.globalAlpha = 1;

      if(game.over){
        ctx.fillStyle = "rgba(0,0,0,0.25)";
        ctx.fillRect(0,0,W,H);

        ctx.fillStyle = "rgba(255,255,255,0.92)";
        ctx.strokeStyle = "rgba(0,0,0,0.25)";
        ctx.lineWidth = 8;
        ctx.fillRect(W*0.18, H*0.22, W*0.64, H*0.22);
        ctx.strokeRect(W*0.18, H*0.22, W*0.64, H*0.22);

        ctx.fillStyle = "#0b1030";
        ctx.font = "900 44px " + getComputedStyle(document.body).fontFamily;
        ctx.textAlign = "center";
        ctx.fillText("GAME OVER", W*0.50, H*0.34);

        ctx.font = "900 18px " + getComputedStyle(document.body).fontFamily;
        ctx.fillText("SPACE / ↑ / KLICK = RESTART", W*0.50, H*0.40);
      }
    }

    function drawRunner67(ctx, x, y){
      ctx.save();
      ctx.translate(x, y);

      ctx.fillStyle = "rgba(0,0,0,0.25)";
      ctx.fillRect(-4, 6, 54, 10);

      ctx.fillStyle = "#3df3ff";
      ctx.strokeStyle = "rgba(0,0,0,0.35)";
      ctx.lineWidth = 7;
      ctx.fillRect(0, -56, 48, 48);
      ctx.strokeRect(0, -56, 48, 48);

      ctx.fillStyle = "rgba(255,255,255,0.22)";
      ctx.fillRect(6, -50, 12, 30);

      ctx.fillStyle = "#0b1030";
      ctx.font = "900 28px " + getComputedStyle(document.body).fontFamily;
      ctx.textAlign = "center";
      ctx.fillText("67", 24, -22);

      ctx.fillStyle = "#0b1030";
      ctx.fillRect(8, -8, 10, 10);
      ctx.fillRect(30, -8, 10, 10);

      ctx.restore();
    }

    /* ============================================================
      Victory logic
    ============================================================ */
    function showVictory(){
      victory.classList.add("show");
      victory.setAttribute("aria-hidden","false");
      playWin();
      startConfetti();
    }

    function hideVictory(){
      victory.classList.remove("show");
      victory.setAttribute("aria-hidden","true");
      stopConfetti();
    }

    function maybeVictory(){
      if(countDone() === ITEMS.length){
        showVictory();
      }
    }

    /* ============================================================
      Global init
    ============================================================ */
    function init(){
      load();
      makeStars();
      updateMusicUI();

      // Try enable video if file exists (best-effort)
      // If mp4 missing, video stays hidden.
      startVideo.addEventListener("error", ()=>{});
      startVideo.addEventListener("loadeddata", ()=>{
        startVideo.classList.add("show");
        startVideo.play().catch(()=>{});
      });
    }

    window.addEventListener("resize", ()=>{
      makeStars();
      if(victory.classList.contains("show")) resizeConfetti();
    });

    // unlock audio for UI beeps
    window.addEventListener("pointerdown", ()=>{ ensureAudio(); }, {once:true});

    // verhindert iOS scroll-bounce im Overlay (wichtig für Game taps)
    overlay.addEventListener("touchmove", (e)=> e.preventDefault(), { passive:false });

    init();
  </script>
</body>
</html>
